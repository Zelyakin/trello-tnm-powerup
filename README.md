# T&M Power-Up для Trello

Это Power-Up для Trello, который позволяет отслеживать затраченное время на карточках.

## Возможности

- Отслеживание затраченного времени на задачи в удобном формате (1d 2h 30m)
- Выбор пользователя, от имени которого будет добавлено время (по умолчанию - текущий пользователь)
- История всех записей с указанием пользователя
- Возможность удаления записей времени из истории
- Полный сброс всех данных на доске при необходимости
- Настройка почасовой ставки
- Отображение бейджей с затраченным временем на карточках
- Отображение сводки времени на обратной стороне карточки
- Кнопка для принудительного обновления Power-Up (очистка кеша)

## Установка

1. Клонируйте репозиторий
2. Разместите файлы на GitHub Pages или другом веб-сервере
3. Зарегистрируйте Power-Up в Trello Power-Up Admin: https://trello.com/power-ups/admin
4. Добавьте Power-Up на вашу доску Trello

## Использование

1. Откройте карточку на доске Trello
2. Нажмите кнопку "T&M" в меню карточки
3. Выберите пользователя, от имени которого вы хотите добавить время (по умолчанию выбран текущий пользователь)
4. Добавьте затраченное время в формате "1d 2h 30m" (дни, часы, минуты)
   - Примеры: "2h 30m", "1d", "45m", "1d 6h"
5. Просмотрите сводку времени на обратной стороне карточки
6. При необходимости удалите неправильные записи с помощью кнопки "Удалить" в разделе "История"

### Управление данными

- Для очистки кеша и обновления Power-Up нажмите кнопку "Обновить T&M" на панели инструментов доски
- Для полного сброса всех данных на доске нажмите кнопку "Удалить все данные" в том же диалоговом окне (будьте осторожны, это действие необратимо!)

## Обновление Power-Up

Если вы видите устаревшую версию Power-Up после обновления кода:

1. Нажмите кнопку "Обновить T&M" на панели инструментов доски
2. В открывшемся окне нажмите "Очистить кеш и перезагрузить"
3. Перезагрузите страницу с доской (Ctrl+F5 или Cmd+Shift+R)

## Разработка

- Используйте `index.html` в качестве точки входа
- Основной код находится в `js/client.js`
- Утилиты для работы с хранилищем в `js/storage.js`
- Утилиты для работы с пользователями доски в `js/board-members.js`
- Интерфейс для работы с карточкой в `views/card-detail.html`
- Отображение на обратной стороне карточки в `views/card-back.html`
- Настройки Power-Up в `views/settings.html`
- Очистка кеша и сброс данных в `views/clear-cache.html`

## Технические детали

Power-Up использует хранилище Trello для сохранения данных:
- Данные карточек хранятся в области 'card', 'shared', 'tnm-data'
- Настройки доски хранятся в области 'board', 'shared', 'tnm-settings'
- Маркер версии кеша хранится в области 'board', 'shared', 'tnm-cache-version'

## TODO

- [ ] Добавить версионирование в URL для предотвращения проблем с кешированием
- [ ] Реализовать экспорт данных о затраченном времени в CSV
- [ ] Добавить возможность фильтрации по пользователям
- [ ] Реализовать отчеты о затраченном времени по всей доске
- [ ] Улучшить мобильную поддержку
- [ ] Добавить поддержку различных форматов дат и времени
- [ ] Реализовать автоматическое резервное копирование данных

## Структура хранимых данных

```javascript
// Структура данных карточки
{
  days: 0, // Дни
  hours: 2, // Часы
  minutes: 30, // Минуты
  history: [
    {
      id: 1620000000001,
      type: "time",
      days: 0,
      hours: 2,
      minutes: 30,
      description: "Работа над задачей",
      date: "2025-05-11T14:30:00.000Z",
      memberId: "user123",
      memberName: "Иван Петров"
    }
  ]
}

// Структура настроек доски
{
  hourlyRate: 1500,
  currency: "RUB"
}
# T&M Power-Up для Trello

Это Power-Up для Trello, который позволяет отслеживать затраченное время и материалы на карточках.

## Возможности

- Отслеживание затраченного времени на задачи
- Учет использованных материалов
- История всех записей с указанием пользователя
- Настройка почасовой ставки
- Отображение бейджей с затраченным временем на карточках
- Отображение сводки времени и материалов на обратной стороне карточки
- Кнопка для принудительного обновления Power-Up (очистка кеша)

## Установка

1. Клонируйте репозиторий
2. Разместите файлы на GitHub Pages или другом веб-сервере
3. Зарегистрируйте Power-Up в Trello Power-Up Admin: https://trello.com/power-ups/admin
4. Добавьте Power-Up на вашу доску Trello

## Использование

1. Откройте карточку на доске Trello
2. Нажмите кнопку "T&M" в меню карточки
3. Добавьте затраченное время или материалы
4. Просмотрите сводку времени на обратной стороне карточки

## Обновление Power-Up

Если вы видите устаревшую версию Power-Up после обновления кода:

1. Нажмите кнопку "Обновить T&M" на панели инструментов доски
2. В открывшемся окне нажмите "Очистить кеш и перезагрузить"
3. Перезагрузите страницу с доской (Ctrl+F5 или Cmd+Shift+R)

## Разработка

- Используйте `index.html` в качестве точки входа
- Основной код находится в `js/client.js`
- Утилиты для работы с хранилищем в `js/storage.js`
- Интерфейс для работы с карточкой в `views/card-detail.html`
- Отображение на обратной стороне карточки в `views/card-back.html`
- Настройки Power-Up в `views/settings.html`
- Очистка кеша в `views/clear-cache.html`

## Технические детали

Power-Up использует хранилище Trello для сохранения данных:
- Данные карточек хранятся в области 'card', 'shared', 'tnm-data'
- Настройки доски хранятся в области 'board', 'shared', 'tnm-settings'

## TODO

- [ ] Добавить версионирование в URL для предотвращения проблем с кешированием
- [ ] Реализовать экспорт данных о затраченном времени в CSV
- [ ] Добавить возможность фильтрации по пользователям
- [ ] Реализовать отчеты о затраченном времени по всей доске
- [ ] Улучшить мобильную поддержку
- [ ] Добавить поддержку различных форматов дат и времени
- [ ] Реализовать автоматическое резервное копирование данных

## Структура хранимых данных

```javascript
// Структура данных карточки
{
  time: 10.5, // Общее затраченное время в часах
  materials: [
    {
      id: 1620000000000,
      name: "Название материала",
      quantity: 2,
      cost: 100,
      date: "2025-05-11T12:30:00.000Z"
    }
  ],
  history: [
    {
      id: 1620000000001,
      type: "time",
      amount: 2.5,
      description: "Работа над задачей",
      date: "2025-05-11T14:30:00.000Z",
      memberId: "user123",
      memberName: "Иван Петров"
    },
    {
      id: 1620000000000,
      type: "material",
      materialId: 1620000000000,
      date: "2025-05-11T12:30:00.000Z"
    }
  ]
}

// Структура настроек доски
{
  hourlyRate: 1500,
  currency: "RUB"
}
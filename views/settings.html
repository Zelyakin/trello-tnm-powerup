<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>T&M Настройки</title>
  <link rel="stylesheet" href="https://p.trellocdn.com/power-up.min.css">
  <link rel="stylesheet" href="../css/style.css">
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
<div class="container">
  <h2>Настройки T&M</h2>

  <div class="form-group">
    <label for="hourly-rate">Почасовая ставка:</label>
    <input type="number" id="hourly-rate" min="0" step="0.01" placeholder="0.00">
  </div>

  <div class="form-group">
    <label for="currency">Валюта:</label>
    <select id="currency">
      <option value="RUB">RUB - Российский рубль</option>
      <option value="USD">USD - Доллар США</option>
      <option value="EUR">EUR - Евро</option>
    </select>
  </div>

  <button class="mod-primary" id="save-settings">Сохранить настройки</button>
</div>

<script src="../js/storage.js"></script>
<script>
  const t = TrelloPowerUp.iframe();

  // Загрузка настроек
  t.render(function() {
    TnMStorage.getBoardSettings(t)
            .then(function(settings) {
              document.getElementById('hourly-rate').value = settings.hourlyRate || '';
              document.getElementById('currency').value = settings.currency || 'RUB';
            });
  });

  // Сохранение настроек
  document.getElementById('save-settings').addEventListener('click', function() {
    const hourlyRate = parseFloat(document.getElementById('hourly-rate').value) || 0;
    const currency = document.getElementById('currency').value;

    TnMStorage.saveBoardSettings(t, {
      hourlyRate: hourlyRate,
      currency: currency
    })
            .then(function() {
              t.closePopup();
            });
  });
</script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Очистка кеша T&M</title>
  <link rel="stylesheet" href="https://p.trellocdn.com/power-up.min.css">
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
<div style="padding: 20px; text-align: center;">
  <h2>Очистка кеша Power-Up</h2>
  <p>Нажмите кнопку ниже для очистки кеша и перезагрузки Power-Up:</p>
  <button id="clear-cache-btn" class="mod-primary">Очистить кеш и перезагрузить</button>
  <p id="status-message" style="margin-top: 16px; color: #0079BF; display: none;">Кеш очищен. Перезагрузка...</p>
</div>

<script>
  const t = TrelloPowerUp.iframe();

  document.getElementById('clear-cache-btn').addEventListener('click', function() {
    // Очищаем локальный временный кеш
    localStorage.clear();

    // Показываем сообщение о статусе
    document.getElementById('status-message').style.display = 'block';

    // Обновляем маркер времени последнего обновления
    t.set('board', 'shared', 'tnm-cache-version', Date.now())
            .then(function() {
              // Закрываем окно и перезагружаем страницу через 2 секунды
              setTimeout(function() {
                t.closePopup();
                window.location.reload(true);
              }, 2000);
            });
  });
</script>
</body>
</html>